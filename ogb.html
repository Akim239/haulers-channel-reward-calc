<!DOCTYPE html>

<head>
  <title>Haulers Channel - Base Rate Calculator</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="style-ogb.css">
  <script src="utils.js"></script>
  <script>
  	  function AllCalc() {
        var reward = CalcReward();
		if (!reward){return;}
        var ipj = reward / parseInt($('#jumps').val().replace(/[^\d\.\-\ ]/g, ''));
        
        if (reward > 0) {
          $('#reward_label').addClass('active');
          $('#reward_ipj_label').addClass('active');
          $('#reward').val(numberWithCommas(reward.toFixed(2).toString()));

          ipj = ipj.toFixed(2).toString();
          $('#reward_ipj').val(numberWithCommas(ipj));
          stuff_to_copy_to_clipboard = reward;
        }
      }
	  function NumFormat(value){
return value
          .replace(/\D/g, "")
          .replace(/\B(?=(\d{3})+(?!\d))/g, ",")
          ;
}

        function numberWithCommas(x) {
          return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
		
			  
	  function CalcReward(){
		var volume = parseFloat($( '#volume').val().replace(/[^\d\.\-\ ]/g, ''));
		var jumps = parseInt($('#jumps').val().replace(/[^\d\.\-\ ]/g, ''));
		var collat = parseFloat($('#collateral').val().replace(/[^\d\.\-\ ]/g, ''));
		var type = $('#type_ipj').prop('checked')?'L':'H';
		
		if (!volume || !jumps || !collat){return;}
		
		var base = 1e6;
		var add = 0;
		var mult = 1;
		if (volume <= 12e3){mult *= 1;}
		else if(volume <= 60e3){mult *= 1;}
		if (volume > 62500 && collat < 1e9){collat = (3e9+collat) * 0.25;}//low freighter collat pays more
		
		if (jumps < 1){jumps = 1;}//same system counts as 1 jump
		if (jumps < 5){//low jumps pay more.
			jumps = (5+jumps)*0.5;
		}
		if (collat >1e9 && volume <= 60e3){//progressive rebate for very high collats
			mult /= Math.max(1.0,Math.log( collat/1e8)/Math.log(10));
		}
		if (collat > 3e9 && volume > 60e3){
			mult *= Math.max(1.0,Math.log( collat/15e7)/Math.log(15));
		}
		
		if (volume > 1050e3){
			add += 250e3;
			if (collat > 2e9){
				add += 200e3;
			}
		}
		else if (volume > 880e3){
			if (collat > 1.5e9){
				add += 100e3;
			}
			if (collat > 2.5e9){
				add += 100e3;
			}
			if (collat > 3e9){
				add += 200e3;
			}
		}
		else if (volume > 750e3){
			if (collat > 2.5e9){
				add += 100e3;
			}
			if (collat > 3e9){
				add += 200e3;
			}
		}
		else if (volume > 500e3){
			if (collat > 2.0e9){
				add += 100e3;
			}
			if (collat > 3.5e9){
				add += 100e3;
			}
		}

		
		if ($('#rush').prop('checked')) {
			if (collat > 2e9){
				mult *= 2.0 * Math.max(1.0,Math.log( collat/1e8)/Math.log(20));
			}
			else{
				mult *= 2.0;
			}
			if (type == 'L'){mult *= 2;}
		}
		if (type == 'L'){
			mult *= 2;
			//Non JF lowsec pays double.
		} 
		if (type == 'H' || volume <= 62500){//highsec or non JF lowsec
			return ((mult * base *collat / 1e9) + add) * jumps;
		}
		else {//null, JF
			base = 60e6;
			if (volume < 100){mult = 0.25;}
			else if (volume <= 12e3){mult = 0.5;}
			else if (volume <= 60e3){mult = 0.75;}
			else if (volume <= 340e3){mult = 1;}
			else {mult = 4;}
			if ($('#rush').prop('checked')) {
			  mult *= 2;
			}
			return (mult * base * (Math.max(1.0,jumps/7)) + collat * 0.01);
		}
	  }
    $(document).ready(function(){
      // Used by the auto copy to clipboard
      var stuff_to_copy_to_clipboard = "";


      // Puts commas in input field
      $('input.to_format_number').blur(function(event) {
        // skip for arrow keys
        if(event.which >= 37 && event.which <= 40) return;
        // format number
        $(this).val(function(index, value) {
          return NumFormat( value);
        });
      });

	  


      $('.to_change').on( 'change paste keyup', AllCalc);
    });
  </script>
</head>
<body class="grey darken-3">
<style>
.input-field label,label{color:white}
.volume-btn{
	margin:1px 5%;width:90%;font-size:0.8em;height:2.5em;line-height:2.5em;padding:0.2em 0.2em;
}
</style>
  <div class="container">
    <div class="row">
      <div class="round_box col s12" style="margin-top: 0px;">
        <div class="row">
          <!-- Header -->
          <div class="header col s12">
            <h1 class="center-align title" style="color: #FFFFFF; font-size: 8em">Haulers Channel</h1>
            <h4 class="grey-text darken-3 center-align title" style="margin-top: -20px; margin-bottom: 60px; font-size: 4.5em">Base Rate Calculator</h4>
          </div>
          <!--<hr>-->
          <!-- Input Area -->
          <div class="col s12 input_area" style="margin-left: 15px;color:white;">
            <div class="row">
              <!-- Left Side -->
              <div class="col s3 offset-s2" style=";margin-top:15px">
                <form class="col s12">
                  <div class="row">
                    <div class="input-field col s12">
                      <input id="collateral" type="text" value=""class="to_format_number to_change">
                      <label id="collateral_label" for="collateral">Collateral</label>
                    </div>
                    <div class="input-field col s12">
                      <input id="jumps" type="text" value="" class="to_format_number to_change">
                      <label id="jumps_label" for="jumps"># of Jumps</label>
                    </div>
                  </div>
                </form>
              </div>
              <!-- Right Side -->
              <div class="col s3" style="margin-left: -21px;margin-top:15px">
                  <!-- Output Area -->
                  <div class="col s12">
                    <div class="row bottom_area">
                      <!-- Bottom Area -->
                      <div class="input-field col s12">
                        <input style="color: black;" value=""id="volume" type="text" class="to_format_number to_change">
                        <label id="volume_label" for="volume">Volume</label>
						<button class="btn grey darken-2 volume-btn" onclick="$( '#volume').val( '600,000');$( '#volume').focus();AllCalc()">Freighter</button>
						<button class="btn grey darken-2 volume-btn" onclick="$( '#volume').val( '60,000');$( '#volume').focus();AllCalc()">Deep Space Transport</button>
						<button class="btn grey darken-2 volume-btn" onclick="$( '#volume').val( '12,000');$( '#volume').focus();AllCalc()">Blocade Runner</button>
                      </div>
                      <div class="input-field col s12">
                      </div>
                    </div>
                  </div>
              </div>
              <!-- Center -->
              <div class="col s3" style="margin-left: -21px;">
                  <!-- Output Area -->
                  <div class="col s12 output_area">
                    <div class="row bottom_area">
                      <!-- Bottom Area -->
                      <div class="input-field col s12">
                        <input style="color: green;" id="reward" type="text" class="">
                        <label id="reward_label" for="reward">Reward</label>
                      </div>
						  <p class="left-align" style="margin-left: 10px">
							<input type="checkbox" class="filled-in to_change" value="L" id="type_ipj"/>
							<label for="type_ipj">Low/Nullsec</label>
						  </p>
                    <p class="left-align" style="margin-left: 10px">
                      <input type="checkbox" class="filled-in to_change" value="1" id="rush"/>
                      <label for="rush">Rush Delivery &nbsp;&nbsp;</label>
                    </p>
                    </div>
                  </div>
              </div>
            </div>
          </div>
          <!-- Footer -->
          <div class="disclaimer_footer">
            <p class="center-align" style="color: #FFFFFF"><span style="color: yellow">Disclaimer: </span>The Final Price is entirely up to yourself.</p>
            <p class="center-align" style="color: #FFFFFF">This calculator assumes the contract starts and ends near a hub.</p>
            <p class="center-align" style="color: #FFFFFF"> This calculator is intended for people new to courier contracts, anything under</p>
            <p class="center-align" style="color: #FFFFFF">these values will normally move slower than normal., and possibly not at all.</p>
            <p class="center-align" style="color: #FFFFFF"><strong>Note: <i>The more you pay </i> = the less you wait.</strong></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
